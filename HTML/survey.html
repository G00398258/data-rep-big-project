<html lang="en">
    <head>
        <!-- AJAX JQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <!-- CSS only -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <!-- JavaScript Bundle with Popper -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
        
        <!-- https://forum.freecodecamp.org/t/space-between-radio-button-and-the-word/493595 -->
        <style>
            .radiobtn {
                margin-left:10px; margin-right:10px;
            }
        </style>
        <title>Survey</title>
    </head>

    <body>
        <div id="welcome">
            <h1> IT Pulse Survey </h1>
            <h4> Welcome to the IT Pulse Survey!</h4>
            <p>In our efforts to improve your overall IT experience, we are taking a quick survey to understand what is working well and what could be improved in the IT space.</p>
            <p>To begin, please click the Take Survey button below.<p>
            <button id="showSurveyButton" onclick="showCreate()">Take Survey</button>
        </div>

        <div id="createForm" style="display:none">
            <h2>Please Enter Your Responses Below</h2>
            <input type="hidden" name="id"/>
            <p>Please enter your Employee ID: <br/>
            <input type="number" name="employeeID"/></p>
            <p>On a scale of 1-10, how would you rate your overall IT experience? <br/>
            <img src="images/scale.png" title = "Score Scale" alt = "Picture: Colour and sentiment scale" hspace="5" width = "470" height="33"> <br/>
            <input class="radiobtn" type="radio" name="overallIT" value="1">1
            <input class="radiobtn" type="radio" name="overallIT" value="2">2
            <input class="radiobtn" type="radio" name="overallIT" value="3">3
            <input class="radiobtn" type="radio" name="overallIT" value="4">4
            <input class="radiobtn" type="radio" name="overallIT" value="5">5
            <input class="radiobtn" type="radio" name="overallIT" value="6">6
            <input class="radiobtn" type="radio" name="overallIT" value="7">7
            <input class="radiobtn" type="radio" name="overallIT" value="8">8
            <input class="radiobtn" type="radio" name="overallIT" value="9">9
            <input class="radiobtn" type="radio" name="overallIT" value="10">10
            </p>

            <p>On a scale of 1-10, how satisfied are you with your Dell laptop? <br/>
            <img src="images/scale.png" title = "Score Scale" alt = "Picture: Colour and sentiment scale" hspace="5" width = "470" height="33"> <br/>
            <input class="radiobtn" type="radio" name="laptop" value="1">1
            <input class="radiobtn" type="radio" name="laptop" value="2">2
            <input class="radiobtn" type="radio" name="laptop" value="3">3
            <input class="radiobtn" type="radio" name="laptop" value="4">4
            <input class="radiobtn" type="radio" name="laptop" value="5">5
            <input class="radiobtn" type="radio" name="laptop" value="6">6
            <input class="radiobtn" type="radio" name="laptop" value="7">7
            <input class="radiobtn" type="radio" name="laptop" value="8">8
            <input class="radiobtn" type="radio" name="laptop" value="9">9
            <input class="radiobtn" type="radio" name="laptop" value="10">10
            </p>
        
            <p>On a scale of 1-10, how would you rate your Dell issued accessories and peripherals (monitors, headsets, keyboards, etc.)? <br/>
            <img src="images/scale.png" title = "Score Scale" alt = "Picture: Colour and sentiment scale" hspace="5" width = "470" height="33"> <br/>
            <input class="radiobtn" type="radio" name="accessories" value="1">1
            <input class="radiobtn" type="radio" name="accessories" value="2">2
            <input class="radiobtn" type="radio" name="accessories" value="3">3
            <input class="radiobtn" type="radio" name="accessories" value="4">4
            <input class="radiobtn" type="radio" name="accessories" value="5">5
            <input class="radiobtn" type="radio" name="accessories" value="6">6
            <input class="radiobtn" type="radio" name="accessories" value="7">7
            <input class="radiobtn" type="radio" name="accessories" value="8">8
            <input class="radiobtn" type="radio" name="accessories" value="9">9
            <input class="radiobtn" type="radio" name="accessories" value="10">10
            </p>

            <p>On a scale of 1-10, how would you rate the applications you use for your role? <br/>
            <img src="images/scale.png" title = "Score Scale" alt = "Picture: Colour and sentiment scale" hspace="5" width = "470" height="33"> <br/>
        
            <input class="radiobtn" type="radio" name="apps" value="1">1
            <input class="radiobtn" type="radio" name="apps" value="2">2
            <input class="radiobtn" type="radio" name="apps" value="3">3
            <input class="radiobtn" type="radio" name="apps" value="4">4
            <input class="radiobtn" type="radio" name="apps" value="5">5
            <input class="radiobtn" type="radio" name="apps" value="6">6
            <input class="radiobtn" type="radio" name="apps" value="7">7
            <input class="radiobtn" type="radio" name="apps" value="8">8
            <input class="radiobtn" type="radio" name="apps" value="9">9
            <input class="radiobtn" type="radio" name="apps" value="10">10
            </p>
    
            <p>On a scale of 1-10, how would you rate the IT Support available to you (via phone, chat, service desk and onsite)? <br/>
            <img src="images/scale.png" title = "Score Scale" alt = "Picture: Colour and sentiment scale" hspace="5" width = "470" height="33"> <br/>
            
            <input class="radiobtn" type="radio" name="support" value="1">1
            <input class="radiobtn" type="radio" name="support" value="2">2
            <input class="radiobtn" type="radio" name="support" value="3">3
            <input class="radiobtn" type="radio" name="support" value="4">4
            <input class="radiobtn" type="radio" name="support" value="5">5
            <input class="radiobtn" type="radio" name="support" value="6">6
            <input class="radiobtn" type="radio" name="support" value="7">7
            <input class="radiobtn" type="radio" name="support" value="8">8
            <input class="radiobtn" type="radio" name="support" value="9">9
            <input class="radiobtn" type="radio" name="support" value="10">10
            </p>
            
            <p>What's going well? Please enter any positive feedback you have to share <br/>
            <textarea name="posFeedback" rows="6" cols="70">
                </textarea> </p>
            
            <p>
            What could be improved? Please enter any negative feedback you have to share <br/>
            <textarea name="negFeedback" rows="6" cols="70">
                </textarea> </p>
            
            <p>Finally, do you consent to having your contact information shared with stakeholders for follow up post survey? <br/>
                <input class="radiobtn" type="radio" name="followUp" value="yes">Yes
                <input class="radiobtn" type="radio" name="followUp" value="no">No
            </p>
    
            <button id="doCreateUpdateButton" onclick="doCreateUpdate()">Submit</button>
            <br/>
        </div>

        <div id="thankyou" style="display:none">
            <h1> Thank you for taking the time to complete the IT Pulse Survey!</h1>
            <!-- Resposnse ID will be entered in here by the DOM -->
            <h3 id="responseID"></h3>
            <p> To view the current survey results, please click the button below.</p>
            <br>
            <button id="showResultsButton" onclick="showResults()">View Results</button>
            <br>
            <p>To review, update or delete your response, please click the button below.</p>
            <br>
            <button id="updateDeleteButton" onclick="showUpdateDelete()">View Your Response</button>
            <br>
        </div>

        <div id="updateDelete" style="display:none">
            <h1 id="heading">Update / Delete Survey Response</h1>
            <p>Please enter your Response ID: <br/>
                <input type="number" name="responseID"></p>
                <br/>
                <button id="retrieveButton" onclick="retrieveRecord()">View Survey Responses</button>
                
            </table>
            <br/>

        </div>

        <div id="results" style="display:none">
            <table class="table" id="resultsTable">
                <tr>
                        <th>Response ID</th>
                        <th>Overall IT</th>
                        <th>Laptops</th>
                        <th>Accessories</th>
                        <th>Applications</th>
                        <th>Support</th>
                        <th>Positive Feedback</th>
                        <th>Negative Feedback</th>
                        <th>Follow Up</th>
                </tr>
                
            </table>
            <br/>

        </div>

        <div id="updateDeleteButtons" style="display:none">
            <!-- Employee ID will be inserted here-->
            <h5 id="empID"></h5>
            <br/>
            <button id="updateButton" onclick="updateRecord()">Update Response</button>
            <button id="deleteButton" onclick="warningMsg()">Delete Response</button>
            <br/>
            <p><h3 id="warning msg" style="display:none">WARNING: You are about to delete your response</h3></p>
            <button id="confirmButton" style="display:none" onclick="deleteRecord()">Confirm Delete</button>
        </div>
        


    </body>

    <script>

        function showCreate(){
            document.getElementById('welcome').style.display="none";
            document.getElementById('createForm').style.display="inline-block";
        }

        function doCreateUpdate(){
            var form = document.getElementById('createForm')

            var record = {}
        
            record.EmployeeID = form.querySelector('input[name="employeeID"]').value
            
            //code below adapted from: https://www.geeksforgeeks.org/how-to-get-value-of-selected-radio-button-using-javascript/
            var ele = document.getElementsByName('overallIT');
            for(i = 0; i < ele.length; i++) {
                if(ele[i].checked)
                    record.IT_Overall_Score = ele[i].value;}
            var ele = document.getElementsByName('laptop');
            for(i = 0; i < ele.length; i++) {
                if(ele[i].checked)
                    record.Laptop_Score = ele[i].value;}
            var ele = document.getElementsByName('accessories');
            for(i = 0; i < ele.length; i++) {
                if(ele[i].checked)
                    record.Accessories_Score = ele[i].value;}
            var ele = document.getElementsByName('apps');
            for(i = 0; i < ele.length; i++) {
                if(ele[i].checked)
                    record.Applications_Score = ele[i].value;}
            var ele = document.getElementsByName('support');
            for(i = 0; i < ele.length; i++) {
                if(ele[i].checked)
                    record.Support_Score = ele[i].value;}
            
            record.Positive_Feedback = form.querySelector('textarea[name="posFeedback"]').value
            record.Negative_Feedback = form.querySelector('textarea[name="negFeedback"]').value
            
            var ele = document.getElementsByName('followUp');
            for(i = 0; i < ele.length; i++) {
                if(ele[i].checked)
                    record.Follow_Up = ele[i].value;}

            console.log(JSON.stringify(record))

            //if employee ID field is disabled, then we're doing an update, not a create
            //https://bobbyhadz.com/blog/javascript-check-if-element-is-disabled
            if (form.querySelector('input[name="employeeID"]').disabled) {
                updateRecordAjax(record);
            } else {
                createRecordAjax(record);
            }
        }
        

    function createRecordAjax(record){
        console.log(JSON.stringify(record));
        $.ajax({
            "url": "http://127.0.0.1:5000/survey",
            "method":"POST",
            "data":JSON.stringify(record),
            "dataType": "JSON",
            contentType: "application/json; charset=utf-8",
            "success":function(result){
                console.log(result);
                record.id = result.ResponseID
                document.getElementById('createForm').style.display="none";
                document.getElementById('thankyou').style.display="inline-block";
                document.getElementById('responseID').innerHTML="Your Response ID is "+record.id+" - please take note of this ID in case you need to amend your survey response";
                //window.location.href = "thankyou.html";
                //addRecordToTable(record)
                //clearForm()
                //showViewAll()
            },
            "error":function(xhr,status,error){
                console.log("error: "+status+" msg:"+error);
            }
        });
    }

        function showResults(){
            document.getElementById('thankyou').style.display="none";
            document.getElementById('results').style.display="inline-block";
            getAllAjax()
        }
        
        function getAllAjax(){
        $.ajax({
            "url": "http://127.0.0.1:5000/survey",
            "method":"GET",
            "data":"",
            "dataType": "JSON",
            "success":function(result){
                //console.log(result);
                for (record of result){
                    addRecordToTable(record);
                }
                
            },
            "error":function(xhr,status,error){
                console.log("error: "+status+" msg:"+error);
            }
        });

    }

        function addRecordToTable(record){
            var tableElement = document.getElementById('resultsTable')
            var rowElement = tableElement.insertRow(-1)
            //rowElement.setAttribute('id',record.id)
            var cell1 = rowElement.insertCell(0);
            cell1.innerHTML = record.ResponseID
            var cell2 = rowElement.insertCell(1);
            cell2.innerHTML = record.IT_Overall_Score
            var cell3 = rowElement.insertCell(2);
            cell3.innerHTML = record.Laptop_Score
            var cell4 = rowElement.insertCell(3);
            cell4.innerHTML = record.Accessories_Score
            var cell5 = rowElement.insertCell(4);
            cell5.innerHTML = record.Applications_Score
            var cell6 = rowElement.insertCell(5);
            cell6.innerHTML = record.Support_Score
            var cell7 = rowElement.insertCell(6);
            cell7.innerHTML = record.Positive_Feedback
            var cell8 = rowElement.insertCell(7);
            cell8.innerHTML = record.Negative_Feedback
            var cell9 = rowElement.insertCell(8);
            cell9.innerHTML = record.Follow_Up

    }
    function showUpdateDelete(){
        document.getElementById('thankyou').style.display="none";
        document.getElementById('updateDelete').style.display="inline-block";
    }

    function retrieveRecord(){
        //document.getElementById('updateDeleteTable').style.display="inline-block";
        var form = document.getElementById('updateDelete')
        responseID = form.querySelector('input[name="responseID"]').value
        console.log(responseID)
        getRecordAjax(responseID);

    }

    function getRecordAjax(responseID){
        $.ajax({
            "url": "http://127.0.0.1:5000/survey/"+responseID,
            "method":"GET",
            "data":"",
            "dataType": "JSON",
            "success":function(result){
                console.log(result);
                document.getElementById('results').style.display="inline-block";
                addRecordToTable(result);
                document.getElementById('updateDeleteButtons').style.display="inline-block";
                document.getElementById('empID').innerHTML="Employee ID: "+result.EmployeeID+" (this cannot be amended)";
                },
                
            "error":function(xhr,status,error){
                console.log("error: "+status+" msg:"+error);
                console.log(url)
            }
        });

    }

    function updateRecord(){
        document.getElementById('results').style.display="none";
        document.getElementById('updateDelete').style.display="none";
        document.getElementById('updateDeleteButtons').style.display="none";
        document.getElementById('createForm').style.display="inline-block";

        //clearing the results table and form
        var tableElement = document.getElementById('resultsTable')
        tableElement.deleteRow(-1);
        clearFormForUpdate()
    }

    function clearFormForUpdate(){
        var form = document.getElementById('createForm')
        //not allowing users to change their employee ID
        form.querySelector('input[name="employeeID"]').disabled = true

        // https://bobbyhadz.com/blog/javascript-set-radio-to-checked-unchecked
        document.getElementsByName('overallIT').checked=false;
        document.getElementsByName('laptop').checked=false;
        document.getElementsByName('accessories').checked=false;
        document.getElementsByName('apps').checked=false;
        document.getElementsByName('support').checked=false;   
        document.getElementsByName('followUp').checked=false;

        form.querySelector('textarea[name="posFeedback"]').value=''
        form.querySelector('textarea[name="negFeedback"]').value=''
        
        
    }

    function updateRecordAjax(record){
        console.log(JSON.stringify(record));
        $.ajax({
            "url": "http://127.0.0.1:5000/survey/"+responseID,
            "method":"PUT",
            "data":JSON.stringify(record),
            "dataType": "JSON",
            contentType: "application/json; charset=utf-8",
            "success":function(result){
                // console.log(result);
                document.getElementById('createForm').style.display="none";
                document.getElementById('thankyou').style.display="inline-block";
                document.getElementById('responseID').innerHTML="Your Response ID is "+responseID+" - please take note of this ID in case you need to amend your survey response";
                  
            },
            "error":function(xhr,status,error){
                console.log("error: "+status+" msg:"+error);
                console.log(responseID);
            }
        });
    }
    


    </script>

</html>